# Zephyr Project Template

This template is designed to **kick‑start** Zephyr‑based embedded applications, **build them reproducibly**, and **port them across different boards** with ease.  
After setup, you can simply edit the `.env` file and run the `scripts/build.ps1` script to build.
> For details, see `scripts/build.md`.

---

## Overview

- **Modular layout:** Under `app/`, the application entry point, helper libraries, and optional drivers/wireless components are logically separated.
- **Portable builds:** `scripts/build.ps1` automatically manages **venv activation** and **Ninja/CMake** arguments.
- **DTS overlay workflow:** Manage pin mapping and node settings in the project with a board‑specific `boards/<board>.overlay`.
- **VS Code ready:** `.vscode/settings.json` is preconfigured for a solid Zephyr/C development experience.

---

## Directory Structure

```text
.
├─ .build/                     # (output) build directory — can be changed via .env/parameter
├─ .vscode/
│  └─ settings.json            # Recommended VS Code settings
├─ app/
│  ├─ main/
│  │  ├─ include/main.h
│  │  ├─ src/main.c            # Application entry
│  │  └─ CMakeLists.txt
│  └─ utils/
│     └─ log/
│        ├─ logger.h           # Lightweight logger interface (example)
│        └─ CMakeLists.txt
├─ boards/
│  └─ nucleo_f070rb.overlay    # DTS overlay for the board (can be empty)
├─ scripts/
│  ├─ .env                     # Build configuration (example file)
│  └─ build.ps1                # Zephyr build script (PowerShell)
├─ .gitattributes
├─ .gitignore
├─ CMakeLists.txt              # Project root CMake
├─ Kconfig                     # Project Kconfig (if needed)
├─ prj.conf                    # Zephyr configuration
├─ LICENSE
└─ README.md
```

> **Note:** If you **don’t want to override** the overlay file, simply create `boards/<board>.overlay` as an **empty** file. The script checks for its existence and passes it to CMake as `EXTRA_DTC_OVERLAY_FILE`.

---

## Quick Start

1. **Prerequisites:** Python + venv, Zephyr + west, Zephyr SDK, CMake, Ninja.  
2. Edit your `scripts/.env`:
   ```ini
   BOARD=nucleo_f070rb
   DT_OVERLAY=boards/nucleo_f070rb.overlay
   BUILD_DIR=.build
   CLEAN=0
   ACTIVATE=1
   ZEPHYR_BASE=C:/.../zephyrproject/zephyr
   ZEPHYR_SDK_INSTALL_DIR=C:/.../zephyr-sdk-0.17.2
   NINJA_EXE=C:/.../ninja-win/ninja.exe
   ```
3. Build:
   ```powershell
   pwsh .\scriptsuild.ps1 -a
   ```
   Clean/pristine build:
   ```powershell
   pwsh .\scriptsuild.ps1 -c -a
   ```

**Change board/overlay:**
```powershell
pwsh .\scriptsuild.ps1 -b nucleo_f070rb -dto boards
ucleo_f070rb.overlay -a
```

---

## Configuration Files

- **`prj.conf`**: Kernel/driver features, thread priorities, log levels, etc.
- **`boards/<board>.overlay`**: Pin mux, aliases, device node settings. (Can be empty.)
- **`.env`**: Board, overlay, build directory, SDK paths, venv activation.
- **`Kconfig`**: Optional root Kconfig for project‑specific options.

---

## CMake Layout

- Each subdirectory includes its own `CMakeLists.txt` and can be treated like an independent module.
- The root `CMakeLists.txt` includes the required subdirectories using `add_subdirectory()`.
- `compile_commands.json` is generated by the script automatically (for IDE integration).

Example subdirectory `CMakeLists.txt` skeleton:
```cmake
zephyr_include_directories(${CMAKE_CURRENT_SOURCE_DIR}/include)

target_sources(app PRIVATE
  ${CMAKE_CURRENT_SOURCE_DIR}/src/main.c
)
```

---

## Helper Libraries

- **`app/utils/log/logger.h`**: Placeholder for a lightweight logging interface (extend with your own macros/levels).
- Add drivers under `app/peripherals/` or wireless components under `app/wireless/` as needed:
  - `app/peripherals/sensors/...`
  - `app/wireless/ble/...`, `app/wireless/wifi/...`

---

## VS Code Tips

- `.vscode/settings.json` is tuned for basic IntelliSense and build experience.
- Recommended extensions: *C/C++*, *CMake Tools*, *Cortex‑Debug*.
- `compile_commands.json` improves navigation and auto‑completion.

---

## Troubleshooting

**`west not found on PATH`**  
- Set `ACTIVATE=1` in `.env` or use `-a` with the script.  
- Check for venv:  
  `Test-Path '<zephyrproject>/.venv/Scripts/Activate.ps1'`  
  If it exists, activate manually:  
  `. '<zephyrproject>/.venv/Scripts/Activate.ps1'` and run `west --version`.

**`ninja.exe not found`**  
- Provide full path via `NINJA_EXE` in `.env` or add Ninja to `PATH`.

**Overlay error**  
- Is the path correct? Even an empty file must exist (`boards/<board>.overlay`).

**Porting to a different board**  
- Change `BOARD`, and add a new overlay and `prj.conf` tweaks if needed.

---

## License

See the `LICENSE` file.

---

This template is optimized to get you started with adding new boards/sensors, editing overlays, and running portable builds with **minimal friction**.
